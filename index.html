<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="孤独是人生的常态">
<meta property="og:type" content="website">
<meta property="og:title" content="Williny&#39;home">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Williny&#39;home">
<meta property="og:description" content="孤独是人生的常态">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="williny">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Williny'home</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Williny'home</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="williny"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">williny</p>
  <div class="site-description" itemprop="description">孤独是人生的常态</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">174</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/suchangche" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;suchangche" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:469478061@qq.com" title="E-Mail → mailto:469478061@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/03/UE5-%E5%88%9D%E8%A7%81GamePlay%E6%A1%86%E6%9E%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/03/UE5-%E5%88%9D%E8%A7%81GamePlay%E6%A1%86%E6%9E%B6/" class="post-title-link" itemprop="url">UE5-初见GamePlay框架</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-06-03 12:31:02 / 修改时间：16:06:27" itemprop="dateCreated datePublished" datetime="2023-06-03T12:31:02+08:00">2023-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/UE5/" itemprop="url" rel="index"><span itemprop="name">UE5</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="GameMode"><a href="#GameMode" class="headerlink" title="GameMode"></a>GameMode</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>是整个关卡的控制器，用来编写整个关卡的业务逻辑。</p>
<p>相当于每个关卡都是一个世界，<code>GameMode</code>则是给这个世界填充世界规则的<code>天道</code>。</p>
<p>比如说现在有一个赛车游戏，率先抵达终点的玩家赢得此游戏的胜利，那么这一条规则就应该写在<code>GameMode</code>里面</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ol>
<li><p>在网络游戏环境中<code>GameMode</code>不会复制到加入多人游戏的远程客户端；它只存在于服务器上，因此本地客户端可看到之前使用过的留存 Game Mode 类（或蓝图）；但无法访问实际的实例并检查其变量，确定游戏进程中已发生哪些变化。</p>
</li>
<li><p>一个游戏中可以存在多个<code>GameMode</code>，但给定时间上只能使用一个 <code>GameMode</code>。每次关卡进行游戏实例化时 <code>GameModeActor</code> 将通过 <code>UGameEngine::LoadMap()</code> 函数进行实例化。</p>
<ul>
<li>人话：一个游戏内可以存在多个关卡和多个<code>GameMode</code>，每个关卡加载的时候都会将指定的<code>GameMode</code>实例化一次</li>
</ul>
</li>
<li><p><code>GameMode</code>可以派生为一个蓝图实例，然后再<code>WorldSetting-&gt;GameMode</code>下面设置具体的<code>GameMode</code></p>
</li>
<li><p><code>GameMode</code>派生为一个蓝图之后，可以在其中设置诸多属性</p>
<ul>
<li><p>默认Pawn</p>
</li>
<li><p>HUD类</p>
</li>
<li><p>PlayerController</p>
</li>
<li><p>Spectator类</p>
</li>
<li><p>GameState</p>
</li>
<li><p>PlayerState</p>
</li>
</ul>
</li>
</ol>
<h2 id="基类"><a href="#基类" class="headerlink" title="基类"></a>基类</h2><h3 id="AGameModeBase"><a href="#AGameModeBase" class="headerlink" title="AGameModeBase"></a>AGameModeBase</h3><p>所有 Game Mode 均为 <code>AGameModeBase</code> 的子类。而 <code>AGameModeBase</code> 包含大量可覆盖的基础功能。</p>
<table>
<thead>
<tr>
<th>函数&#x2F;事件</th>
<th>目的</th>
</tr>
</thead>
<tbody><tr>
<td><code>InitGame</code></td>
<td><code>InitGame</code> 事件在其他脚本之前调用（包括 <code>PreInitializeComponents</code>），由 <code>AGameModeBase``PreInitializeComponents</code></td>
</tr>
<tr>
<td><code>PreLogin</code></td>
<td>接受或拒绝尝试加入服务器的玩家。如它将 <code>ErrorMessage</code> 设为一个非空字符串，会导致 <code>Login</code> 函数失败。<code>PreLogin</code> 在 <code>Login</code> 前调用，Login 调用前可能需要大量时间，加入的玩家需要下载游戏内容时尤其如此。</td>
</tr>
<tr>
<td><code>PostLogin</code></td>
<td>成功登录后调用。这是首个在 <code>PlayerController</code> 上安全调用复制函数之处。<code>OnPostLogin</code> 可在蓝图中实现，以添加额外的逻辑。</td>
</tr>
<tr>
<td><code>HandleStartingNewPlayer</code></td>
<td>在 <code>PostLogin</code> 后或无缝游历后调用，可在蓝图中覆盖，修改新玩家身上发生的事件。它将默认<mark>创建一个玩家 pawn</mark>。</td>
</tr>
<tr>
<td><code>RestartPlayer</code></td>
<td>调用开始生成一个玩家 pawn。如需要指定 Pawn 生成的地点，还可使用 <code>RestartPlayerAtPlayerStart</code> 和 <code>RestartPlayerAtTransform</code> 函数。<code>OnRestartPlayer</code> 可在蓝图中实现，在此函数完成后添加逻辑。</td>
</tr>
<tr>
<td><code>SpawnDefaultPawnAtTransform</code></td>
<td>这实际生成玩家 Pawn，可在蓝图中覆盖。</td>
</tr>
<tr>
<td><code>Logout</code></td>
<td><mark>玩家离开游戏或被摧毁时</mark>调用。可实现 <code>OnLogout</code> 执行蓝图逻辑。</td>
</tr>
</tbody></table>
<h3 id="AGameMode"><a href="#AGameMode" class="headerlink" title="AGameMode"></a>AGameMode</h3><p><code>AGameMode</code> 是 <code>AGameModeBase</code> 的子类，拥有一些额外支持多人游戏的功能和行为。</p>
<p>所有新建项目默认使用 <code>AGameModeBase</code>。</p>
<p>如果需要此额外行为，可切换到从 <code>AGameMode</code> 进行继承。</p>
<p>如从 <code>AGameMode</code> 进行继承，也可从 <code>AGameState</code> 继承游戏状态（其支持比赛状态机）。</p>
<p><code>AGameMode</code> 包含一个跟踪比赛状态或整体游戏流程的状态机。可使用 <code>GetMatchState</code> 或 <code>HasMatchStarted</code>、<code>IsMatchInProgress</code> 和 <code>HasMatchEnded</code> 之类的封装器查询当前的状态。以下是可能的比赛状态：</p>
<ul>
<li><p><code>EnteringMap</code> ：初始状态。Actor 尚未进行 tick，世界场景尚未完整初始化。内容完整加载后将过渡到下个状态。</p>
</li>
<li><p><code>WaitingToStart</code> 是下个状态，进入时将调用 <code>HandleMatchIsWaitingToStart</code>。Actor 正在进行 tick，但玩家尚未生成。如 <code>ReadyToStartMatch</code> 返回 <em>true</em> 或 <code>StartMatch</code> 被调用，它将过渡到下个状态。</p>
</li>
<li><p><code>InProgress</code> 是游戏主体所发生的状态。进入此状态时将调用 <code>HandleMatchHasStarted</code>，然后在所有 Actor 上调用 <code>BeginPlay</code>。此时，正常游戏进程已在进行中。<code>ReadyToEndMatch</code> 返回 <em>true</em> 或调用 <code>EndMatch</code> 时比赛将过渡到下个状态。</p>
</li>
<li><p><code>WaitingPostMatch</code> 是倒数第二个状态，进入时将调用 <code>HandleMatchHasEnded</code>。Actor 仍在 tick，但新玩家无法加入。地图转换开始时它将过渡到下个状态。</p>
</li>
<li><p><code>LeavingMap</code> 是正常流程中的最后一个状态，进入时将调用 <code>HandleLeavingMap</code>。转换到新地图时比赛将保持在此状态中，进入新地图时将过渡回到 <code>EnteringMap</code>。</p>
</li>
<li><p><code>Aborted</code> 是失败状态，调用 <code>AbortMatch</code> 可开始此状态。出现无法恢复的错误时将进行此设置。</p>
</li>
</ul>
<p>游戏状态将固定为 <code>InProgress</code>，因为这是调用 <code>BeginPlay</code>、actor 开始 tick 的状态。然而，个体游戏可能覆盖这些状态的行为，用更复杂的规则构建一个多人游戏，如在一款多人射击游戏中等待其他玩家加入时允许玩家在关卡中自由飞行。</p>
<h2 id="设置GameMode"><a href="#设置GameMode" class="headerlink" title="设置GameMode"></a>设置GameMode</h2><p>详情参见<a target="_blank" rel="noopener" href="https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/Framework/GameMode/">Game Mode 和 Game State | 虚幻引擎文档</a></p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.2/en-US/API/Runtime/Engine/GameFramework/AGameMode/">AGameMode | Unreal Engine Documentation</a></p>
<h1 id="GameState"><a href="#GameState" class="headerlink" title="GameState"></a>GameState</h1><h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><p><strong>Game State</strong> 负责启用客户端监控游戏状态。从概念上而言，Game State 应该管理所有已连接客户端已知的信息（特定于 Game Mode 但不特定于任何个体玩家）。它能够追踪游戏层面的属性，如已连接玩家的列表、夺旗游戏中的团队得分、开放世界游戏中已完成的任务，等等。</p>
<p>Game State 并非追踪玩家特有内容（如夺旗比赛中特定玩家为团队获得的分数）的最佳之处，因为它们由 <strong>Player State</strong> 更清晰地处理。整体而言，GameState 应该追踪游戏进程中变化的属性。这些属性与所有人皆相关，且所有人可见。Game mode 只存在于服务器上，而 Game State 存在于服务器上且会被复制到所有客户端，保持所有已连接机器的游戏进程更新。</p>
<h2 id="人话"><a href="#人话" class="headerlink" title="人话"></a>人话</h2><p><code>GameState</code>用于存储和监控当前游戏状态数据，这些状态数据应该是全体玩家共享的，而不是某个玩家独有的。</p>
<p>例如一个解密关卡中一扇门是否已经被打开，就应该记录在<code>GameState</code>里面。</p>
<p>并且<code>GameState</code>每个客户端都有一份</p>
<h2 id="基类-1"><a href="#基类-1" class="headerlink" title="基类"></a>基类</h2><p><code>AGameStateBase</code> 是基础实现，其部分默认功能包括：</p>
<table>
<thead>
<tr>
<th>函数或变量</th>
<th>使用</th>
</tr>
</thead>
<tbody><tr>
<td><code>GetServerWorldTimeSeconds</code></td>
<td>这是 <code>UWorld</code> 函数 <code>GetTimeSeconds</code> 的服务器版本，将在客户端和服务器上同步，因此该时间可用于复制，十分可靠。</td>
</tr>
<tr>
<td><code>PlayerArray</code></td>
<td>这是所有 <code>APlayerState</code> 对象的阵列，对游戏中所有玩家执行操作时十分实用。</td>
</tr>
<tr>
<td><code>HasBegunPlay</code></td>
<td>如 <code>BeginPlay</code> 函数在游戏中的 actor 上调用，则返回 true。</td>
</tr>
</tbody></table>
<p><code>AGameStateBase</code> 通常在 C++ 或蓝图中延展，包含用于使游戏中玩家知晓当前情况的额外变量和函数。进行的特定修改通常基于 Game State 的配对 Game Mode。Game Mode 自身也可将其默认 Game State 类覆盖为派生自 <code>AGameStateBase</code> 的任意 C++ 类或蓝图。</p>
<h1 id="GameMode和GameState之间的关系"><a href="#GameMode和GameState之间的关系" class="headerlink" title="GameMode和GameState之间的关系"></a>GameMode和GameState之间的关系</h1><p>一言以蔽之</p>
<p><code>GameMode</code>使用<code>GameState</code>中的数据</p>
<h1 id="PlayerState"><a href="#PlayerState" class="headerlink" title="PlayerState"></a>PlayerState</h1><p>是玩家的状态，用来存储和玩家相关的状态数据。</p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>关卡切换的时候<code>PlayerState</code>会被销毁然后重新生成</p>
<h2 id="PlayerState-数据如何保存是否保存到下一个关卡？"><a href="#PlayerState-数据如何保存是否保存到下一个关卡？" class="headerlink" title="PlayerState 数据如何保存是否保存到下一个关卡？"></a>PlayerState 数据如何保存是否保存到下一个关卡？</h2><p>通过重写 PlayerState中 Reset()&#x2F;CopyProperties 方法</p>
<h3 id="CopyProperties"><a href="#CopyProperties" class="headerlink" title="CopyProperties"></a>CopyProperties</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如重写一个M_PlayerState，重写CopyProperties方法进行跨关卡数据存储</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AM_PlayerState::CopyProperties</span><span class="params">(APlayerState* PlayerState)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    Super::<span class="built_in">CopyProperties</span>(PlayerState);</span><br><span class="line"> </span><br><span class="line">    PlayerState-&gt;Hp = Hp;</span><br><span class="line">    PlayerState-&gt;MaxHp = MaxHp;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Reset"><a href="#Reset" class="headerlink" title="Reset()"></a>Reset()</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Reset 方法,可以自定义初始化数据,如部分数据需要初始化则添加至Reset中，</span></span><br><span class="line"><span class="comment">//需要保留数据放在CopyProperties</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">APlayerState::Reset</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">Reset</span>();</span><br><span class="line">    <span class="built_in">SetScore</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">ForceNetUpdate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Pawn与PlayerController下的PlayerState"><a href="#Pawn与PlayerController下的PlayerState" class="headerlink" title="Pawn与PlayerController下的PlayerState"></a>Pawn与PlayerController下的PlayerState</h2><ol>
<li><p>pawn中的PlayerState 是 controller中PlayerState的引用</p>
</li>
<li><p>controller中的PlayerState对象在initPlayerState()中初始化。当possessed一个pawn的时候 会把自己的PlayerState 设置给pawn中的PlayerState对象。unpossessed的时候会把pawn中的PlayerState对象设置为null。</p>
</li>
<li><p>PlayerState是跟着controller走的，controller中的PlayerState是根源。</p>
</li>
<li><p>PlayerState 的getowner 就是 controller</p>
</li>
<li><p>PlayerState的GetPawn获得当前的pawn 有可能是null</p>
</li>
</ol>
<h2 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h2><p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.2/en-US/API/Runtime/Engine/GameFramework/APlayerState/">APlayerState | Unreal Engine Documentation</a></p>
<h1 id="PlayerController"><a href="#PlayerController" class="headerlink" title="PlayerController"></a>PlayerController</h1><h2 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h2><p>把人类抽象为肉体和灵魂来看，Character是人类的肉体，PlayerController则是人类的灵魂。</p>
<p>在虚幻引擎的世界中，人类的灵魂是在一局游戏中一直存在的，但肉体是有可能被销毁死亡的。</p>
<p>也就是说PlayerController是在整个游戏进程中是一直存在的，玩家的Character是可能随时被销毁掉的。</p>
<p>PlayerController存在的意义是<code>灵魂操控肉体</code></p>
<h2 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h2><ol>
<li><p>PlayerController在游戏进程中一直存在</p>
</li>
<li><p>PlayerController在服务器和客户端上同时存在</p>
</li>
<li><p>应该用PlayerController给Character发送指令让其行动</p>
</li>
</ol>
<h2 id="API-2"><a href="#API-2" class="headerlink" title="API"></a>API</h2><p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.2/en-US/API/Runtime/Engine/GameFramework/APlayerController/">APlayerController | Unreal Engine Documentation</a></p>
<h1 id="Character"><a href="#Character" class="headerlink" title="Character"></a>Character</h1><h2 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h2><p>人类&#x2F;AI的肉体</p>
<p>玩家就像一个修仙者一样，<code>PlayerController</code>是玩家的灵魂，玩家可以通过夺舍的方式更换自己的<code>Character</code>。</p>
<p>需要注意的是，<code>PlayerController</code>和<code>Character</code>都是具有输入输出操作的。</p>
<p>虚幻这样设计的意义是什么呢？</p>
<p>假设我现在的肉体是人族，人族的天赋技能是<code>勤劳</code>和<code>学习</code>，当我拥有这个人族肉体的时候，我的输入就可以让我施展<code>勤劳</code>和<code>学习</code>两个技能。但当我去夺舍了一个龙族的肉体，龙族的天赋技能是<code>龙息</code>和<code>魔法</code>，那么此时我再使用技能，就只能使用<code>龙息</code>和<code>魔法</code>两个技能了。之前人族的技能，因为不是对应的肉体，我不可以使用。</p>
<p>那我作为玩家的专属技能<code>天选之人</code>，这个技能是跟着灵魂走的。所以不管我换多少个肉体，都不会丢失这个技能。</p>
<p>再通俗一点讲，LOL里面召唤师技能写在<code>PlayerController</code>里面，英雄技能写在<code>Character</code>里面。</p>
<h2 id="API-3"><a href="#API-3" class="headerlink" title="API"></a>API</h2><p><a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.2/en-US/API/Runtime/Engine/GameFramework/ACharacter/">ACharacter | Unreal Engine Documentation</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/02/UE5-%E5%88%9D%E8%A7%81%E5%BC%95%E6%93%8E%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/02/UE5-%E5%88%9D%E8%A7%81%E5%BC%95%E6%93%8E%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99/" class="post-title-link" itemprop="url">UE5-初见引擎编译规则</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-02 23:06:07" itemprop="dateCreated datePublished" datetime="2023-06-02T23:06:07+08:00">2023-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-03 12:32:16" itemprop="dateModified" datetime="2023-06-03T12:32:16+08:00">2023-06-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/UE5/" itemprop="url" rel="index"><span itemprop="name">UE5</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Intermediate"><a href="#Intermediate" class="headerlink" title="Intermediate"></a>Intermediate</h1><p>新建一个虚幻项目，会在其路径文件夹下发现名为<code>Intermediate</code>的文件夹</p>
<ol>
<li><p>保存构建项目和使用引擎的临时文件</p>
</li>
<li><p>此文件夹中存在一些和虚幻引擎反射机制相关的生成内容</p>
<ul>
<li><code>反射机制</code>生成的文件存储在路径<code>项目名\Intermediate\Build\Win64\UnrealEditor\Inc\项目名称\UHT</code>路径下</li>
</ul>
</li>
<li><p>可以删除，每次在引擎中打开&#x2F;gengerate项目就会重新创建</p>
</li>
</ol>
<h1 id="UE5如何编译目标"><a href="#UE5如何编译目标" class="headerlink" title="UE5如何编译目标"></a>UE5如何编译目标</h1><h2 id="编译端（客户端，服务端，编译器，单机）"><a href="#编译端（客户端，服务端，编译器，单机）" class="headerlink" title="编译端（客户端，服务端，编译器，单机）"></a>编译端（客户端，服务端，编译器，单机）</h2><p>在虚幻创建的项目中，在<code>Source</code>文件夹下可以找到两个<code>.cs</code>类型的文件，根据它们的命名，可以看到他们的编译目标分别为<code>编辑器，单机</code></p>
<ol>
<li><p>项目名Editor：编辑器</p>
<ul>
<li><code>&quot;DSource\项目名Editor.Target.cs&quot;</code></li>
</ul>
</li>
<li><p>项目名Game：单机</p>
<ul>
<li><code>&quot;DSource\项目名.Target.cs&quot;</code></li>
</ul>
</li>
</ol>
<p>如果在虚幻引擎源码版中，想要开发网络游戏，可以创建两个新的文件，分别对应服务端以及客户端</p>
<ol>
<li><p>项目名Client：客户端</p>
<ul>
<li><code>&quot;DSource\项目名Client.Target.cs&quot;</code></li>
</ul>
</li>
<li><p>项目名Server：服务器</p>
<ul>
<li><code>&quot;DSource\项目名Server.Target.cs&quot;</code></li>
</ul>
</li>
</ol>
<h3 id="名为ProjectFirst-cpp的项目"><a href="#名为ProjectFirst-cpp的项目" class="headerlink" title="名为ProjectFirst_cpp的项目"></a>名为ProjectFirst_cpp的项目</h3><p>以下两个默认.cs文件中的源码。</p>
<p>值得注意的是，虚幻引擎对其<code>TargetType</code>做了很多详细的类型区分，比如以下的两个文件中的<code>TargetType</code>为<code>Game</code>以及<code>Editor</code>，那么如果是创建服务器和客户端编译目标，则为<code>Server</code>以及<code>Client</code></p>
<h4 id="ProjectFirst-cpp-Target-cs"><a href="#ProjectFirst-cpp-Target-cs" class="headerlink" title="ProjectFirst_cpp.Target.cs"></a>ProjectFirst_cpp.Target.cs</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnrealBuildTool;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectFirst_cppTarget</span> : TargetRules</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProjectFirst_cppTarget</span><span class="params">(TargetInfo Target)</span> : base(Target)</span></span><br><span class="line"><span class="function">    &#123;</span></span><br><span class="line">        Type = TargetType.Game;</span><br><span class="line">        DefaultBuildSettings = BuildSettingsVersion.V2;</span><br><span class="line">        IncludeOrderVersion = EngineIncludeOrderVersion.Unreal5_1;</span><br><span class="line">        ExtraModuleNames.<span class="built_in">Add</span>(<span class="string">&quot;ProjectFirst_cpp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ProjectFirst-cppEditor-Target-cs"><a href="#ProjectFirst-cppEditor-Target-cs" class="headerlink" title="ProjectFirst_cppEditor.Target.cs"></a>ProjectFirst_cppEditor.Target.cs</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnrealBuildTool;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectFirst_cppEditorTarget</span> : TargetRules</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProjectFirst_cppEditorTarget</span><span class="params">(TargetInfo Target)</span> : base(Target)</span></span><br><span class="line"><span class="function">    &#123;</span></span><br><span class="line">        Type = TargetType.Editor;</span><br><span class="line">        DefaultBuildSettings = BuildSettingsVersion.V2;</span><br><span class="line">        IncludeOrderVersion = EngineIncludeOrderVersion.Unreal5_1;</span><br><span class="line">        ExtraModuleNames.<span class="built_in">Add</span>(<span class="string">&quot;ProjectFirst_cpp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="模块化编译"><a href="#模块化编译" class="headerlink" title="模块化编译"></a>模块化编译</h1><p>虚幻引擎的源码非常庞大，如果每次启动编译的时候将全部代码都编译一次，就会显得很笨蛋，所以虚幻采用了模块化编译的方式解决这个问题。</p>
<p>其实我之前再Roblox中的状态机系统和虚幻的模块化加载思路是非常相似的。</p>
<p>简而言之就是，虚幻将一些功能相关性强的代码写在同一个模块里面，而开发者在使用这些功能的时候，需要让虚幻加载这些指定的模块。指定行的加载功能模块，不用加载用不到的模块，尽可能的减少了编译的开销。</p>
<p>模块的加载写在<code>项目名.Build.cs</code>文件内</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright Epic Games, Inc. All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnrealBuildTool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectFirst_cpp</span> : ModuleRules</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProjectFirst_cpp</span><span class="params">(ReadOnlyTargetRules Target)</span> : base(Target)</span></span><br><span class="line"><span class="function">    &#123;</span></span><br><span class="line">        PCHUsage = PCHUsageMode.UseExplicitOrSharedPCHs;</span><br><span class="line"></span><br><span class="line">        PublicDependencyMo</span><br><span class="line">duleNames.<span class="built_in">AddRange</span>(<span class="keyword">new</span> string[] </span><br><span class="line">&#123; </span><br><span class="line"><span class="string">&quot;Core&quot;</span>,                 </span><br><span class="line"><span class="string">&quot;CoreUObject&quot;</span>,         </span><br><span class="line"><span class="string">&quot;Engine&quot;</span>, </span><br><span class="line"><span class="string">&quot;InputCore&quot;</span>, </span><br><span class="line"><span class="string">&quot;HeadMountedDisplay&quot;</span>, </span><br><span class="line"><span class="string">&quot;EnhancedInput&quot;</span> </span><br><span class="line">&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这段代码中，我们可以加载虚幻引擎自带的模块，也可以自定义模块并且在这里进行加载。</p>
<p>假设需要使用虚幻引擎中的Slate功能，则需要在这里添加<code>&quot;Slate&quot;</code>模块，详情参见<a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.0/zh-CN/using-slate-in-a-project-in-unreal-engine/">在虚幻引擎项目中使用Slate | 虚幻引擎5.0文档</a>以及<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/602251790">【UE5】使用Slate进行UI开发与编辑器拓展（二）：简单Slate独立程序</a></p>
<h1 id="UProject"><a href="#UProject" class="headerlink" title="UProject"></a>UProject</h1><p>打开虚幻文件下的<code>项目名.UProject</code>文件，可以看到如下代码</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;FileVersion&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;EngineAssociation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Modules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ProjectFirst_cpp&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Runtime&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;LoadingPhase&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Default&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;AdditionalDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;Engine&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;Plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ModelingToolsEditorMode&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;Enabled&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;TargetAllowList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;Editor&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这其实是json语法格式，有点像网页前端的编译规则，我们点击UProject的时候可以直接打开虚幻项目，然而UProject内部长这样，很显然并不是一个想象中足以支持打开虚幻源文件的格式。</p>
<p>其实点击这个UProject发生的事情其实是，Uproject将其中包含的信息传入到虚幻引擎中，虚幻引擎再根据这些信息对引擎进行启动。</p>
<ul>
<li><p>Modules描述项目本身</p>
</li>
<li><p>Plugins描述这个项目加载的插件</p>
</li>
</ul>
<h1 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h1><p>自定义模块并且加载详情参见<a target="_blank" rel="noopener" href="https://docs.unrealengine.com/5.0/zh-CN/unreal-engine-modules/#:~:text=%E5%AF%B9%E4%BA%8E%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%8C%E4%BD%A0%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%A8%A1%E5%9D%97%E7%9A%84%E7%A7%81%E6%9C%89%EF%BC%88Private%EF%BC%89%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA.cpp%20%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%85%B6%E5%91%BD%E5%90%8D%E4%B8%BA%20%5BModuleName%5DModule.cpp,%EF%BC%8C%E5%85%B6%E4%B8%AD%20%5BModuleName%5D%20%E6%98%AF%E6%A8%A1%E5%9D%97%E7%9A%84%E5%90%8D%E7%A7%B0%E3%80%82">虚幻引擎模块 | 虚幻引擎5.0文档</a></p>
<p>模块的加载与卸载，以及与插件之间的关系详情参见<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/121152396">插件与模块</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/27/RPG%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E5%AF%B9%E8%AF%9D%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/27/RPG%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91-%E5%AF%B9%E8%AF%9D%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/" class="post-title-link" itemprop="url">RPG游戏开发-对话系统架构</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-05-27 11:41:35 / 修改时间：17:55:28" itemprop="dateCreated datePublished" datetime="2023-05-27T11:41:35+08:00">2023-05-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%B3%BB%E7%BB%9F%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">系统框架设计</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="系统说明"><a href="#系统说明" class="headerlink" title="系统说明"></a>系统说明</h1><p>在一款复杂RPG游戏中，任务往往伴随着各种复杂的对话，这些对话会跟随着任务的推进给玩家展示不同的文本内容与分支选项。</p>
<p>对话系统需要给玩家展示的部分包括：</p>
<ol>
<li><p>NPC文本内容</p>
</li>
<li><p>玩家选项以及选择对应选项会触发的事件</p>
</li>
</ol>
<p>对话是和任务强相关的，对话可以做到发放以及接取任务，而任务可以做到修改对话内容以及分支结构。所以对话系统其实是任务系统的一个附属系统。在设计本系统的时候需要考虑到和任务系统的兼容性。</p>
<h1 id="系统特性"><a href="#系统特性" class="headerlink" title="系统特性"></a>系统特性</h1><ol>
<li><p>本系统是一个后端架构，不需要过于关注前端的表现形式，只需要用高效的方式解决数据结构方面的内容即可。</p>
</li>
<li><p>本系统需要给框架使用者<code>留下足够的拓展和定制化功能开发空间</code>，在遇到需要用对话系统触发的需求，并且此需求在整个游戏流程中使用次数不多，不值得写入对话系统本体的时候，需要留有接口让框架使用者可以定制化开发。</p>
</li>
<li><p>本系统主要<code>运行在客户端</code>，不太需要过于关注反作弊的内容，如果有作弊者操作客户端上对话达到给玩家发放稀有任务。这些反作弊操作应该交给任务系统进行管理。</p>
</li>
<li><p>本系统使用面向对象思想，将每个对话实例化为一个对象，在这个对象上做文章</p>
</li>
</ol>
<h1 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h1><ol>
<li><p>每个玩家都有独属于自己的NPC，这些NPC身上都存在对话。</p>
</li>
<li><p>那我们可以将对话实例化为一个个对象，挂载在这一个个NPC身上即可。</p>
</li>
</ol>
<h1 id="系统框架设计"><a href="#系统框架设计" class="headerlink" title="系统框架设计"></a>系统框架设计</h1><h2 id="数据结构设计"><a href="#数据结构设计" class="headerlink" title="数据结构设计"></a>数据结构设计</h2><h3 id="简单需求使用栈可以解决问题"><a href="#简单需求使用栈可以解决问题" class="headerlink" title="简单需求使用栈可以解决问题"></a>简单需求使用栈可以解决问题</h3><p>我在开发过程中参考过<a target="_blank" rel="noopener" href="https://blog.csdn.net/float_freedom/article/details/126375090"><code>Unity</code>游戏开发：对话系统的实现_unity对话系统-CSDN博客</a>中对话实现的方式，发现是用弹栈，压栈的方式操作对话。此方法可以一定程度上有较好的表现，维护起来也比较方便。</p>
<p>但是这个方法存在一些问题：</p>
<ol>
<li><p>如果单纯用栈来存储对话，当NPC身上存在多个任务相关的对话的时候一个栈无法解决此问题，只能使用多个栈来进行存储。</p>
</li>
<li><p>此方法无法解决NPC的对话，玩家存在多个选择，玩家的选择导向了不同的结果的需求。</p>
</li>
<li><p>对话的<code>改</code>部分相当不好维护，假设我想在对话中间插入一句话，则需要一个个弹栈，然后压栈。</p>
</li>
</ol>
<p>综上所述，用栈来存储对话只能解决一些不复杂的系统需求，如果是复杂的环境，栈处理起来还是比较乏力的。</p>
<h3 id="数组链表"><a href="#数组链表" class="headerlink" title="数组链表"></a>数组链表</h3><p>抛弃栈存储之后，想到《底特律:变人》是以剧情对话为主的游戏，其中的剧情流程图其实就是给玩家打明牌。他们表现出来的结构就是一个横着的多叉树。</p>
<p>但我最终并没有选择使用多叉树来设计数据结构，而是选择使用数组中模拟链表的形式来解决问题。</p>
<p>多叉树和数组链表都可以处理对话回退的需求，但是说实话，做这个系统的时候我其实是存了锻炼自己数据结构的设计能力的心思在里面的，所以就没有选择相对好维护的多叉树来解决。</p>
<p>此数据结构分两层，外层是外部数组，内层是链表。</p>
<h4 id="数据结构详解"><a href="#数据结构详解" class="headerlink" title="数据结构详解"></a>数据结构详解</h4><h5 id="外层数组"><a href="#外层数组" class="headerlink" title="外层数组"></a>外层数组</h5><p>外层的数组决定了这个对话最长的长度。</p>
<p>用lua的Table模拟出来是以下结构</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> DialogueArray=</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="number">1</span>]=&#123;...&#125;,</span><br><span class="line">    [<span class="number">2</span>]=&#123;...&#125;,</span><br><span class="line">    [<span class="number">3</span>]=&#123;...&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们暂且不去考虑内层的链表的数据结构，只考虑外层的数组的功能和初始化方式。</p>
<ol>
<li><p>对话的长度决定了数组的长度（就是NPC说了几句话）</p>
</li>
<li><p>可能会出现一个对话有多个分支选项，其中一个分支选项NPC说了10句话，另一个分支选项NPC只说了5句话。此时数组的长度是10</p>
</li>
<li><p>这个外层数组的最大作用是在出现回退对话选项的时候可以快速找到上一个选项有哪几个链表节点可供玩家选择</p>
</li>
</ol>
<h5 id="内层链表"><a href="#内层链表" class="headerlink" title="内层链表"></a>内层链表</h5><ol>
<li><p>数组元素内存储的是一个个链表的节点。</p>
</li>
<li><p>一个数组元素内可以同时存在多个链表节点。</p>
</li>
<li><p>数组下标为1的元素内存储的链表节点中存储着与链表节点2的元素中的链表节点之间的关系</p>
</li>
</ol>
<p>第三点说起来有点绕口，但实际上很简单，就是常规的链表数据结构，在当前节点描述下一个节点的信息</p>
<p>用lua的Table模拟出来就是这样的</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;节点ID&quot;</span>]=</span><br><span class="line"> &#123;</span><br><span class="line"> Content=<span class="string">&quot;当前节点NPC的文本内容&quot;</span>,</span><br><span class="line"> NextNode=<span class="string">&quot;下一个节点的ID&quot;</span>,</span><br><span class="line"> PreNode=<span class="string">&quot;上一个节点的ID&quot;</span>,</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>但是以上的数据结构还比较简陋，并不具备解决多分支选项的能力。</p>
<p>所以此时需要给这个数据结构加点料！</p>
<p>其实想要解决多分支选项问题很简单，上文中的数据结构中的<code>Next</code>以及<code>Pre</code>字段是一个<code>string</code>类型的变量。我们将其变为一个Table类型的变量即可解决这个问题。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;10003&quot;</span>]=</span><br><span class="line"> &#123;</span><br><span class="line"> Content=<span class="string">&quot;当前节点NPC的文本内容&quot;</span>,</span><br><span class="line"> NexContent=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;这是选项1的文本内容&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;这是选项2的文本内容&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line"> NextNode=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;10001&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;10002&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"> PreNode=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;10004&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;10005&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>这样的链表节点就可以导向多个链表节点了，而将上面的数据结构抽象化则如下图所示。</p>
<p><img src="https://img-blog.csdnimg.cn/a115ba495837410da69bdba9ce2e379a.png"></p>
<p>当然，在正式的对话对象中不可以存在如上图的一个对话对象，因为很显然，对话是挂载在NPC身上的，而NPC身上的对话进入点只能有一个，这意味着不可能存在<code>对话对象开头就是两个节点</code>的情况。</p>
<h5 id="对话系统与任务系统"><a href="#对话系统与任务系统" class="headerlink" title="对话系统与任务系统"></a>对话系统与任务系统</h5><p>上面解决了基本的对话数据结构，但是前文提到了对话系统是和任务系统强相关的，此时还缺少和任务强相关的逻辑。</p>
<p>我们可以在上面的数据结构中再单独嵌套一个表来解决这个问题。</p>
<ul>
<li><p>创建一个顺序表，里面存储着这个对话节点对任务的操作</p>
</li>
<li><p>用顺序表的Index代表操作类型，Value表示要操作的任务</p>
</li>
<li><p><code>Index==1</code>时 代表提交任务，<code>Index==2</code>时 代表发放任务，<code>Index==3</code>时代表发放任务奖励</p>
<ul>
<li>此处为啥要1代表提交任务，2代表发放任务呢？因为在任务系统中存在一种任务，它的接取任务前提是完成某前置任务。假设在对话A中操作玩家提交任务1，并且发放任务2，但任务2的接取条件是完成任务1，如果先发放任务2，再提交任务1，则会被任务系统拦住。用顺序表存储，1一定比2先遍历到，所以1代表提交任务，2代表发放任务</li>
</ul>
</li>
</ul>
<p>只要在玩家遍历到此对话节点，激活一下任务字段里面的逻辑，即可做到对话系统与任务系统的强关联性。</p>
<p>以下是lua添加了此表之后链表节点的数据结构</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;10003&quot;</span>]=</span><br><span class="line"> &#123;</span><br><span class="line"> Content=<span class="string">&quot;当前节点NPC的文本内容&quot;</span>,</span><br><span class="line"> NexContent=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;这是选项1的文本内容&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;这是选项2的文本内容&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line"> NextNode=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;10001&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;10002&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"> PreNode=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;10004&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;10005&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"> QuestOption=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=                    <span class="comment">--玩家选择选项1时候触发的任务操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;任务1&quot;</span>,    <span class="comment">--提交任务1</span></span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;任务2&quot;</span>     <span class="comment">--发放任务2</span></span><br><span class="line">            &#125;,</span><br><span class="line">        [<span class="number">2</span>]=                    <span class="comment">--玩家选择选项2时候触发的任务操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;任务1&quot;</span>,    <span class="comment">--提交任务1</span></span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;任务2&quot;</span>     <span class="comment">--发放任务2</span></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>注意：任务操作和玩家选项是以Index一一对应的</p>
<h5 id="对话系统的定制化需求"><a href="#对话系统的定制化需求" class="headerlink" title="对话系统的定制化需求"></a>对话系统的定制化需求</h5><p>在实际开发中，对话往往成为游戏中某个事件的触发条件，比如在游戏中，NPC与玩家说“来看看我的商店吧！”玩家如果选择“OK”，则会打开NPC商店的UI界面。</p>
<p>此类需求无比繁复，而且不是经常使用，此时我们就需要在对话系统中公开一个区域，让框架使用者可以在里面填写一些信息，达成一些定制化需求的效果。</p>
<ul>
<li><p>创建一个顺序表，用于存储特殊操作函数名</p>
</li>
<li><p>当玩家遍历到此链表节点的时候激活这些函数名代表的函数</p>
</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;10003&quot;</span>]=</span><br><span class="line"> &#123;</span><br><span class="line"> Content=<span class="string">&quot;当前节点NPC的文本内容&quot;</span>,</span><br><span class="line"> NexContent=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;这是选项1的文本内容&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;这是选项2的文本内容&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line"> NextNode=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;10001&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;10002&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"> PreNode=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=<span class="string">&quot;10004&quot;</span>,</span><br><span class="line">        [<span class="number">2</span>]=<span class="string">&quot;10005&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"> QuestOption=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=                    <span class="comment">--玩家选择选项1时候触发的任务操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;任务1&quot;</span>,    <span class="comment">--提交任务1</span></span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;任务2&quot;</span>     <span class="comment">--发放任务2</span></span><br><span class="line">            &#125;,</span><br><span class="line">        [<span class="number">2</span>]=                    <span class="comment">--玩家选择选项2时候触发的任务操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;任务1&quot;</span>,    <span class="comment">--提交任务1</span></span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;任务2&quot;</span>     <span class="comment">--发放任务2</span></span><br><span class="line">            &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"> S_SpecialOperations=            <span class="comment">--服务端特殊操作</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=                     <span class="comment">--玩家选择选项1时候触发的服务端操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;服务端特殊函数名_1&quot;</span>,</span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;服务端特殊函数名_2&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        [<span class="number">2</span>]=                    <span class="comment">--玩家选择选项2时候触发的服务端操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;服务端特殊函数名_1&quot;</span>,</span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;服务端特殊函数名_2&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> C_SpecialOperations=</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="number">1</span>]=                    <span class="comment">--玩家选择选项1时候触发的客户端操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;客户端特殊函数名_1&quot;</span>,</span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;客户端特殊函数名_2&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        [<span class="number">2</span>]=                    <span class="comment">--玩家选择选项2时候触发的客户端操作</span></span><br><span class="line">            &#123;</span><br><span class="line">                [<span class="number">1</span>]=<span class="string">&quot;客户端特殊函数名_1&quot;</span>,</span><br><span class="line">                [<span class="number">2</span>]=<span class="string">&quot;客户端特殊函数名_2&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>本质上其实与任务系统结合方式差不多，只是偷了一点懒，可以不用自己写具体功能，公开给框架使用者即可。</p>
<p>还是上文打开NPC商店的需求，策划在填表的时候只需要从前端程序员处获取打开NPC商店的函数名，填入该对话节点的配置信息里面，玩家遍历到此处，则会激活此函数。</p>
<h2 id="增删查改存取"><a href="#增删查改存取" class="headerlink" title="增删查改存取"></a>增删查改存取</h2><p>业务的本质是增删查改存取</p>
<p>对话系统的增删查改是完全由任务系统驱动的，当玩家接到任务A的时候，任务系统会控制某个NPC身上的对话进行<code>增加该任务相关对话节点</code>的操作，当任务A完成的时候，任务系统会控制某个NPC身上的对话进行<code>删除该任务相关对话节点</code>的操作。</p>
<h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><p>其实增就很好说，就是常规链表的增加节点方式，只是需要注意在外面套的那一层数组，在增加链表节点的时候也需要更新数组的长度以及元素。</p>
<h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><p>这个就很简单，玩家进行对话的过程本质上就是在遍历这个链表，然后根据玩家的选择进入不同的分支而已。</p>
<p>查的本身并不复杂，但是跟后文说的删有一定的关联性。</p>
<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><p>上文说过，玩家进行对话，本质上是在遍历对话链表，但如果玩家遍历对话链表到一半，就直接删掉了当前玩家遍历到的位置，此时就会出问题。</p>
<p>对话系统本身就像是在悬崖上伸出去一根独木桥，玩家遍历就是从悬崖走在独木桥上的过程，如果玩家站在独木桥上10米处，系统直接从独木桥5米处砍断，玩家自然就掉下去了。</p>
<p>所以在删这个对话链表的时候，一定要注意这一点，并且需要在删这个函数内进行容错，如果玩家在10米处，系统想删5米处，直接打回。</p>
<p><img src="https://img-blog.csdnimg.cn/f933a8b4e7764bdf871c34faf7981850.png"></p>
<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><p>改就是修改对话链表中的文本内容，这个好说，也没啥需要注意的，本身并不涉及到整个链表的结构变化。</p>
<h3 id="存与取"><a href="#存与取" class="headerlink" title="存与取"></a>存与取</h3><p>这个就需要好好说说了。</p>
<h4 id="问题所在（数据量）"><a href="#问题所在（数据量）" class="headerlink" title="问题所在（数据量）"></a>问题所在（数据量）</h4><p>NPC是跟着玩家走的，因为玩家的剧情是每个玩家独有的，所以NPC的对话其实是存在玩家数据内的，又因为是一个网游，一个玩家的数据不可以过大，如果我们把每个NPC身上的对话对象直接上传到玩家数据中，则有多少NPC就有多少个对话对象，时间一长，这个玩家的数据就会爆掉。</p>
<h4 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h4><p>其实我们可以不用存玩家的对话对象。</p>
<ol>
<li><p>上文提到了每个NPC都有一个对话对象。</p>
</li>
<li><p>又知道对话对象的增删查改其实都是由任务驱动的。</p>
</li>
<li><p>所以我们只需要根据任务的完成情况，记录这个任务对一些对话的操作即可。</p>
</li>
</ol>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ol>
<li><p>玩家每个任务都会对NPC的对话进行操作，将操作存入一个队列中，每次操作即入队</p>
</li>
<li><p>当玩家任务A完成的时候，直接清除这个任务造成的对话操作队列。</p>
</li>
<li><p>玩家下线之后再上线，读取这些操作队列，将每个NPC身上的对话对象从头到尾操作一遍即可复原。</p>
</li>
</ol>
<h4 id="代价"><a href="#代价" class="headerlink" title="代价"></a>代价</h4><ol>
<li><p>每个任务只能操作本任务的对话，不可以影响其他任务对话的增删查改</p>
</li>
<li><p>每个NPC身上必须携带一个默认的对话对象，复原操作就是对这个对象进行增删查改</p>
<ol>
<li>但不是真的上传的一个对话对象，而是一个对话头节点ID，每次NPC初始化的时候根据这个ID生成一个对话对象即可</li>
</ol>
</li>
<li><p>系列任务必须有持续性，不可以断掉，比如提交任务A之后，任务A结束会立马发放任务B，否则会出现玩家下次上线的时候，任务操作队列中没有数据的情况</p>
</li>
</ol>
<h1 id="完整数据结构图示"><a href="#完整数据结构图示" class="headerlink" title="完整数据结构图示"></a>完整数据结构图示</h1><p><img src="https://img-blog.csdnimg.cn/17ca0604e01e4ce09c677f4f411b3e1f.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/26/Roblox-Tween/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/26/Roblox-Tween/" class="post-title-link" itemprop="url">Roblox-Tween</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-12-26 09:53:23 / 修改时间：09:55:09" itemprop="dateCreated datePublished" datetime="2022-12-26T09:53:23+08:00">2022-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Roblox/" itemprop="url" rel="index"><span itemprop="name">Roblox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Roblox 中的 Tween 是一种动画工具，可以让你轻松地在脚本中创建动画。使用 Tween，你可以在指定的时间内将对象的某些属性从一个值平滑地插值到另一个值。</p>
<p>要在 Roblox 中使用 Tween，你需要使用以下步骤：</p>
<ol>
<li>在需要使用 Tween 的脚本中引入 TweenService 模块：</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local TweenService = game:<span class="built_in">GetService</span>(<span class="string">&quot;TweenService&quot;</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建 TweenInfo 对象，并设置 Tween 的相关参数：</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> tweenInfo = TweenInfo.new(</span><br><span class="line">    duration,  <span class="comment">-- 动画时长，单位是秒</span></span><br><span class="line">    easingStyle,  <span class="comment">-- 缓动类型，可以是 Enum.EasingStyle 中的任意值</span></span><br><span class="line">    easingDirection  <span class="comment">-- 缓动方向，可以是 Enum.EasingDirection 中的任意值</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建 Tween 对象，并设置 Tween 的目标值：</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> tween = TweenService:Create(</span><br><span class="line">    object,  <span class="comment">-- 要操作的对象</span></span><br><span class="line">    tweenInfo,  <span class="comment">-- TweenInfo 对象</span></span><br><span class="line">    &#123;  <span class="comment">-- 目标值表，包含一个或多个属性和对应的值</span></span><br><span class="line">        Property = TargetValue,</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动 Tween：</li>
</ol>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tween:Play()</span><br></pre></td></tr></table></figure>

<p>你也可以使用 Tween&#x2F;Cancel() 方法来取消 Tween：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tween:Cancel()</span><br></pre></td></tr></table></figure>

<p>还可以使用 Tween&#x2F;Completed 属性来获取 Tween 结束时的事件，以及 Tween&#x2F;Cancelled 属性来获取 Tween 被取消时的事件。</p>
<p>例如，你可以使用以下代码来在 Tween 结束时显示一条消息：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tween.Completed:Connect(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Tween completed&quot;</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

<p>下面是一个示例，用 Tween 在 2 秒内将对象的位置从当前位置平滑移动到 (100, 100, 100)：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> TweenService = game:GetService(<span class="string">&quot;TweenService&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> object = script.Parent  <span class="comment">-- 要操作的对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> tweenInfo = TweenInfo.new(<span class="number">2</span>, Enum.EasingStyle.Linear, Enum.EasingD</span><br></pre></td></tr></table></figure>

<p>使用 Tween 来实现 CFrame1 到 CFrame2 的平滑过渡。</p>
<p>在ReplicatedStorage中声明Tween</p>
<p>调用</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Tween = <span class="built_in">require</span>(game.ReplicatedStorage:WaitForChild(<span class="string">&quot;Tween&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 定义 CFrame1 和 CFrame2</span></span><br><span class="line"><span class="keyword">local</span> CFrame1 = CFrame.new(Vector3.new(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"><span class="keyword">local</span> CFrame2 = CFrame.new(Vector3.new(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建一个 Tween 实例</span></span><br><span class="line"><span class="keyword">local</span> tween = Tween.new(<span class="number">5</span>, Tween.EasingStyle.Linear, Tween.EasingDirection.Out)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 Tween 实例上设置 &quot;Value&quot; 属性</span></span><br><span class="line">tween:TweenProperty(<span class="string">&quot;Value&quot;</span>, CFrame1, CFrame2)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接 Tween 实例的 &quot;Value&quot; 属性与某个对象的 &quot;CFrame&quot; 属性</span></span><br><span class="line">tween.Value:Connect(object.CFrame)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开始 Tween 实例</span></span><br><span class="line">tween:Start()</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们创建了一个 Tween 实例，并使用 <code>TweenProperty</code> 方法将 “Value” 属性设置为 CFrame1 和 CFrame2 之间的过渡。然后，我们将 Tween 实例的 “Value” 属性连接到某个对象的 “CFrame” 属性，这样就可以在 Tween 实例运行期间将对象的 CFrame 从 CFrame1 平滑过渡到 CFrame2。</p>
<p>请注意，在这个示例中，我们使用的是线性过渡效果，但是 Tween 模块还提供了其他类型的过渡效果，例如弹性过渡、弧形过渡等。您可以使用 <code>Tween.EasingStyle</code> 和 <code>Tween.EasingDirection</code>参数来调整过渡的类型和方向。</p>
<p>下面是一些例子：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 弹性过渡，由慢到快再到慢</span></span><br><span class="line"><span class="keyword">local</span> tween = Tween.new(<span class="number">5</span>, Tween.EasingStyle.Elastic, Tween.EasingDirection.InOut)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 弧形过渡，由快到慢</span></span><br><span class="line"><span class="keyword">local</span> tween = Tween.new(<span class="number">5</span>, Tween.EasingStyle.Quadratic, Tween.EasingDirection.Out)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 平方过渡，由慢到快</span></span><br><span class="line"><span class="keyword">local</span> tween = Tween.new(<span class="number">5</span>, Tween.EasingStyle.Quadratic, Tween.EasingDirection.In)</span><br></pre></td></tr></table></figure>

<p>此外，还可以使用 <code>Tween.TimeLength</code> 参数来指定过渡的持续时间，使用 <code>Tween.DelayTime</code> 参数来指定过渡开始前的延迟时间，使用 <code>Tween.RepeatCount</code> 参数来指定过渡的重复次数，等等。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/26/Roblox-Input/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/26/Roblox-Input/" class="post-title-link" itemprop="url">Roblox-Input</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-12-26 09:52:02" itemprop="dateCreated datePublished" datetime="2022-12-26T09:52:02+08:00">2022-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-27 11:43:56" itemprop="dateModified" datetime="2023-05-27T11:43:56+08:00">2023-05-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Roblox/" itemprop="url" rel="index"><span itemprop="name">Roblox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h1><h2 id="UserInputService"><a href="#UserInputService" class="headerlink" title="UserInputService"></a>UserInputService</h2><p>使用<code>GetService</code>获取<code>UserInputService</code>，然后通过其中的三个事件监听输入</p>
<h3 id="InputBegan"><a href="#InputBegan" class="headerlink" title="InputBegan"></a>InputBegan</h3><p>此事件仅在Roblox客户端窗口处于焦点时触发</p>
<p>例如：当窗口最小化时不会监听玩家输入</p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li><p>此事件仅在<code>LocalScript</code>中触发</p>
</li>
<li><p>此事件可以与<code>UserInputService.InputChanged</code>以及<code>UserInputService.InputEnded</code>一起用</p>
</li>
</ol>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table>
<thead>
<tr>
<th>参数名</th>
<th>参数描述</th>
</tr>
</thead>
<tbody><tr>
<td>input: InputObject</td>
<td>InputObject实例，包含有关用户输入的信息</td>
</tr>
<tr>
<td>gameProcessedEvent: boolean</td>
<td>指示游戏引擎是否在内部观察到此输入并对其进行操作。通常，这是指UI处理，因此如果从该输入中触摸或单击按钮，gameProcessedEvent将为true。对于通过ContextActionService连接的输入事件也是如此。</td>
</tr>
</tbody></table>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- In order to use the InputBegan event, the UserInputService service must be used</span></span><br><span class="line"><span class="keyword">local</span> UserInputService = game:GetService(<span class="string">&quot;UserInputService&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- A sample function providing multiple usage cases for various types of user input</span></span><br><span class="line">UserInputService.InputBegan:Connect(<span class="function"><span class="keyword">function</span><span class="params">(input, gameProcessed)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Keyboard <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A key is being pushed down! Key:&quot;</span>, <span class="built_in">input</span>.KeyCode)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.MouseButton1 <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The left mouse button has been pressed down at&quot;</span>, <span class="built_in">input</span>.Position)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.MouseButton2 <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The right mouse button has been pressed down at&quot;</span>, <span class="built_in">input</span>.Position)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Touch <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A touchscreen input has started at&quot;</span>, <span class="built_in">input</span>.Position)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Gamepad1 <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A button is being pressed on a gamepad! Button:&quot;</span>, <span class="built_in">input</span>.KeyCode)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> gameProcessed <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The game engine internally observed this input!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The game engine did not internally observe this input!&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

<h4 id="监听玩家键盘输入"><a href="#监听玩家键盘输入" class="headerlink" title="监听玩家键盘输入"></a>监听玩家键盘输入</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> UserInputService = game:GetService(<span class="string">&quot;UserInputService&quot;</span>)</span><br><span class="line">UserInputService.InputBegan:Connect(<span class="function"><span class="keyword">function</span><span class="params">(inputObject)</span></span></span><br><span class="line">    <span class="keyword">if</span> inputObject.KeyCode == Enum.KeyCode.Q <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Q!&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

<h3 id="InputChanged"><a href="#InputChanged" class="headerlink" title="InputChanged"></a>InputChanged</h3><p>与<code>InputBegan</code>的参与与注意事项相同</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- In order to use the InputChanged event, the UserInputService service must be used</span></span><br><span class="line"><span class="keyword">local</span> UserInputService = game:GetService(<span class="string">&quot;UserInputService&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Prints the current input position and the change (delta) in position</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">printMovement</span><span class="params">(input)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Position:&quot;</span>, <span class="built_in">input</span>.Position)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Movement Delta:&quot;</span>, <span class="built_in">input</span>.Delta)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- A sample function providing multiple usage cases for various types of user input</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">InputChanged</span><span class="params">(input, _gameProcessed)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.MouseMovement <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The mouse has been moved!&quot;</span>)</span><br><span class="line">        printMovement(<span class="built_in">input</span>)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.MouseWheel <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The mouse wheel has been scrolled!&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Wheel Movement:&quot;</span>, <span class="built_in">input</span>.Position.Z)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Gamepad1 <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">input</span>.KeyCode == Enum.KeyCode.Thumbstick1 <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;The left thumbstick has been moved!&quot;</span>)</span><br><span class="line">            printMovement(<span class="built_in">input</span>)</span><br><span class="line">        <span class="keyword">elseif</span> <span class="built_in">input</span>.KeyCode == Enum.KeyCode.Thumbstick2 <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;The right thumbstick has been moved!&quot;</span>)</span><br><span class="line">            printMovement(<span class="built_in">input</span>)</span><br><span class="line">        <span class="keyword">elseif</span> <span class="built_in">input</span>.KeyCode == Enum.KeyCode.ButtonL2 <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;The pressure being applied to the left trigger has changed!&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Pressure:&quot;</span>, <span class="built_in">input</span>.Position.Z)</span><br><span class="line">        <span class="keyword">elseif</span> <span class="built_in">input</span>.KeyCode == Enum.KeyCode.ButtonR2 <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;The pressure being applied to the right trigger has changed!&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Pressure:&quot;</span>, <span class="built_in">input</span>.Position.Z)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Touch <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The user&#x27;s finger is moving on the screen!&quot;</span>)</span><br><span class="line">        printMovement(<span class="built_in">input</span>)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Gyro <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> _rotInput, rotCFrame = UserInputService:GetDeviceRotation()</span><br><span class="line">        <span class="keyword">local</span> rotX, rotY, rotZ = rotCFrame:toEulerAnglesXYZ()</span><br><span class="line">        <span class="keyword">local</span> rot = Vector3.new(<span class="built_in">math</span>.<span class="built_in">deg</span>(rotX), <span class="built_in">math</span>.<span class="built_in">deg</span>(rotY), <span class="built_in">math</span>.<span class="built_in">deg</span>(rotZ))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The rotation of the user&#x27;s mobile device has been changed!&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Position&quot;</span>, rotCFrame.p)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Rotation:&quot;</span>, rot)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Accelerometer <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The acceleration of the user&#x27;s mobile device has been changed!&quot;</span>)</span><br><span class="line">        printMovement(<span class="built_in">input</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">UserInputService.InputChanged:Connect(InputChanged)</span><br></pre></td></tr></table></figure>

<h3 id="InputEnded"><a href="#InputEnded" class="headerlink" title="InputEnded"></a>InputEnded</h3><p>注意事项同上</p>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- In order to use the InputChanged event, the UserInputService service must be used</span></span><br><span class="line"><span class="keyword">local</span> UserInputService = game:GetService(<span class="string">&quot;UserInputService&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- A sample function providing multiple usage cases for various types of user input</span></span><br><span class="line">UserInputService.InputEnded:Connect(<span class="function"><span class="keyword">function</span><span class="params">(input, gameProcessed)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Keyboard <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A key has been released! Key:&quot;</span>, <span class="built_in">input</span>.KeyCode)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.MouseButton1 <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The left mouse button has been released at&quot;</span>, <span class="built_in">input</span>.Position)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.MouseButton2 <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The right mouse button has been released at&quot;</span>, <span class="built_in">input</span>.Position)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Touch <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A touchscreen input has been released at&quot;</span>, <span class="built_in">input</span>.Position)</span><br><span class="line">    <span class="keyword">elseif</span> <span class="built_in">input</span>.UserInputType == Enum.UserInputType.Gamepad1 <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A button has been released on a gamepad! Button:&quot;</span>, <span class="built_in">input</span>.KeyCode)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> gameProcessed <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The game engine internally observed this input!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The game engine did not internally observe this input!&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/18/Roblox-MonsterAI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/18/Roblox-MonsterAI/" class="post-title-link" itemprop="url">Roblox-MonsterAI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-12-18 14:27:20 / 修改时间：14:28:08" itemprop="dateCreated datePublished" datetime="2022-12-18T14:27:20+08:00">2022-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Roblox/" itemprop="url" rel="index"><span itemprop="name">Roblox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="实现怪物AI"><a href="#实现怪物AI" class="headerlink" title="实现怪物AI"></a>实现怪物AI</h1><p>1.首先需要在Roblox Studio中创建一个可操作的怪物模型，可以通过Roblox官方商店或者第三方资源库获取。</p>
<p>2.创建怪物的状态机，定义怪物的不同状态，如待机状态、移动状态、攻击状态等。状态机可以通过脚本实现，也可以使用Roblox Studio提供的事件系统进行实现。</p>
<p>3.在游戏中为怪物定义不同的行为，如移动、攻击、被攻击等。行为可以通过脚本实现，也可以通过拖拽Roblox Studio中提供的动画模块实现。</p>
<p>4.为怪物设置一定的随机因素，使得怪物的行为更加真实和多变，如随机移动、随机攻击等。</p>
<p>5.实现怪物的数据存储与管理，包括怪物的生命值、伤害值、移动速度等属性。可以通过Roblox Studio提供的数据存储模块进行实现。</p>
<h2 id="在roblox中实现怪物随机找点移动"><a href="#在roblox中实现怪物随机找点移动" class="headerlink" title="在roblox中实现怪物随机找点移动"></a>在roblox中实现怪物随机找点移动</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> characterModel = script.Parent</span><br><span class="line"><span class="keyword">local</span> humanoid = characterModel.Humanoid</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">  wait(<span class="built_in">math</span>.<span class="built_in">random</span>()*<span class="number">5</span>)</span><br><span class="line">  <span class="keyword">local</span> movePosition = workspace.Target.Position + Vector3.new(<span class="built_in">math</span>.<span class="built_in">random</span>(<span class="number">-40</span>, <span class="number">40</span>), <span class="number">0</span>, <span class="built_in">math</span>.<span class="built_in">random</span>(<span class="number">-40</span>, <span class="number">40</span>))</span><br><span class="line">  humanoid:MoveTo(movePosition)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>在上面的代码中，我们使用<code>wait()</code>函数让怪物在每次移动之间等待一段随机时间。然后使用<code>math.random()</code>生成一个随机的x和z坐标，将其加到当前怪物位置上，最后使用<code>humanoid:MoveTo()</code>函数让怪物移动到新的位置。</p>
<p>在这段代码中，我们假定了有一个名为”workspace.Target”的模型在场景中，它是怪物移动的参考点。你可以根据你游戏中的实际情况来替换它。</p>
<h2 id="在Roblox中使用事件系统实现怪物AI的状态机"><a href="#在Roblox中使用事件系统实现怪物AI的状态机" class="headerlink" title="在Roblox中使用事件系统实现怪物AI的状态机"></a>在Roblox中使用事件系统实现怪物AI的状态机</h2><p>首先，我们需要定义一个模型，用来存放怪物的数据。我们可以在模型中创建一些事件，用来储存怪物的状态。例如，我们可以定义一个“Patrol”事件，表示怪物巡逻的状态。</p>
<p>我们可以在怪物的Script脚本中，通过调用事件的fire方法，来实现状态的切换。例如，当怪物遇到玩家时，我们可以调用“Attack”事件的fire方法，来让怪物从巡逻状态切换到攻击状态。</p>
<h1 id="事件系统"><a href="#事件系统" class="headerlink" title="事件系统"></a>事件系统</h1><p>在Roblox Studio中，选择”Insert”菜单，在下拉菜单中选择”Object”并选择”Script”，新建一个脚本并在其中添加以下代码：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> event = Instance.new(<span class="string">&quot;RemoteEvent&quot;</span>)</span><br><span class="line">event.Name = <span class="string">&quot;myEvent&quot;</span></span><br><span class="line">event.Parent = game</span><br></pre></td></tr></table></figure>

<p>这样就可以创建一个名为”myEvent”的事件，并将其附加到游戏中。可以通过触发此事件来执行相应的代码逻辑。</p>
<p>举个例子，如果想要在玩家进入某个区域时触发这个事件，可以在区域的脚本中添加以下代码：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> event = game:GetService(<span class="string">&quot;ReplicatedStorage&quot;</span>).myEvent</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">onPlayerEnter</span><span class="params">(player)</span></span></span><br><span class="line">  event:Fire(player)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">region.Enter:Connect(onPlayerEnter)</span><br></pre></td></tr></table></figure>

<p>上面的代码中，当玩家进入region区域时，会触发onPlayerEnter函数，在这个函数中调用event:Fire(player)方法，以此来触发myEvent事件。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 假设这里有一个叫做 &quot;myEvent&quot; 的事件</span></span><br><span class="line"><span class="keyword">local</span> myEvent = Instance.new(<span class="string">&quot;BindableEvent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设我们想要在游戏中某个地方监听 &quot;myEvent&quot; 事件</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">onMyEvent</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="comment">-- 这里是事件处理函数，在 &quot;myEvent&quot; 事件发生时会被执行</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">myEvent.Event:Connect(onMyEvent)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 当游戏中的某个事件发生时，可以使用 fire 方法通知监听器</span></span><br><span class="line">myEvent:Fire(...)re(<span class="string">&quot;pistol&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>通过这种方式，可以利用事件系统来实现怪物AI的状态机。例如，可以在怪物的脚本中添加以下代码：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> event = game:GetService(<span class="string">&quot;ReplicatedStorage&quot;</span>).myEvent</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">onStateChanged</span><span class="params">(newState)</span></span></span><br><span class="line">  <span class="keyword">if</span> newState == <span class="string">&quot;idle&quot;</span> <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 怪物处于idle状态，执行相应的代码逻辑</span></span><br><span class="line">  <span class="keyword">elseif</span></span><br></pre></td></tr></table></figure>

<h1 id="实现怪物AI的状态机"><a href="#实现怪物AI的状态机" class="headerlink" title="实现怪物AI的状态机"></a>实现怪物AI的状态机</h1><ol>
<li><p>在Roblox Studio中创建一个脚本作为状态机的管理器，并定义需要的状态</p>
</li>
<li><p>创建一个怪物模型，并在怪物模型中添加一个脚本作为怪物的行为控制器</p>
</li>
<li><p>在怪物的行为控制器中监听状态机管理器发出的状态变化事件，并根据不同的状态执行不同的行为</p>
</li>
<li><p>在状态机管理器中根据怪物的行为状态来发出状态变化事件，控制怪物的行为</p>
</li>
</ol>
<p>这样就可以通过事件系统来实现怪物AI的状态机。</p>
<h2 id="AnimationController"><a href="#AnimationController" class="headerlink" title="AnimationController"></a>AnimationController</h2><p>AnimationController是一个动画控制器，可以用它来控制角色的动画播放。Animator是一个动画状态机，它允许你使用状态机的方式来控制角色的动画状态。 AnimationController和Animator的区别在于，AnimationController更适合控制单个动画的播放，而Animator更适合处理多个动画之间的转换。</p>
<h2 id="使用Animator播放动画"><a href="#使用Animator播放动画" class="headerlink" title="使用Animator播放动画"></a>使用Animator播放动画</h2><p>是负责动画播放和复制的主要类。所有播放<code>AnimationTracks</code>的复制都通过Animator实例处理。</p>
<p>当在<code>Humanoid</code>或<code>AnimationController</code>下调用<code>Humanoid:LoadAnimation()</code>或<code>AnimationController:LoadAnimation()</code>时，会创建<code>Animator</code>。</p>
<p>为了正常复制动画，<code>Animator</code>必须首先在服务器上创建。</p>
<p>如果<code>Animator</code>是玩家角色中<code>Humanoid</code>或<code>AnimationController</code>的后代，那么玩家客户端上开始的动画将复制到服务器和其他客户端。</p>
<p>如果<code>Animator</code>不是玩家角色的后代，则必须在服务器上加载和启动它的动画才能复制</p>
<p><code>Animator</code>对象必须最初在服务器上创建并复制到客户端，才能复制动画。如果在本地创建<code>Animator</code>，则使用该<code>Animator</code>加载的<code>AnimationTracks</code>将不会复制。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">playAnimationFromServer</span><span class="params">(character, animation)</span></span></span><br><span class="line">    <span class="keyword">local</span> humanoid = character:FindFirstChildOfClass(<span class="string">&quot;Humanoid&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> humanoid <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- need to use animation object for server access</span></span><br><span class="line">        <span class="keyword">local</span> animator = humanoid:FindFirstChildOfClass(<span class="string">&quot;Animator&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> animator <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> animationTrack = animator:LoadAnimation(animation)</span><br><span class="line">            animationTrack:Play()</span><br><span class="line">            <span class="keyword">return</span> animationTrack</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> animation = Instance.new(<span class="string">&quot;Animation&quot;</span>)</span><br><span class="line">animation.AnimationId = <span class="string">&quot;rbxassetid://507765644&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> character = script.Parent</span><br><span class="line"></span><br><span class="line">playAnimationFromServer(character, animation)</span><br></pre></td></tr></table></figure>

<p>放置在StarterPlayerScripts中的<code>LocalScript</code>将动画ID为“rbxassetid:&#x2F;&#x2F;2515090838”的动画加载到玩家角色上并播放。</p>
<p>这里为啥用<code>LocalScript</code>？因为控制单一玩家的动画，如果是想控制全部玩家的动画，就使用<code>Script</code></p>
<p>以下的<code>GetMarkerReachedSignal()</code>方法来检测何时可以播放动画。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Players = game:GetService(<span class="string">&quot;Players&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> player = Players.LocalPlayer</span><br><span class="line"><span class="keyword">local</span> character = player.Character</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> character <span class="keyword">or</span> <span class="keyword">not</span> character.Parent <span class="keyword">then</span></span><br><span class="line">    character = player.CharacterAdded:Wait()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Ensure that the character&#x27;s humanoid contains an &quot;Animator&quot; object</span></span><br><span class="line"><span class="keyword">local</span> humanoid = character:WaitForChild(<span class="string">&quot;Humanoid&quot;</span>)</span><br><span class="line"><span class="keyword">local</span> animator = humanoid:WaitForChild(<span class="string">&quot;Animator&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Create a new &quot;Animation&quot; instance and assign an animation asset ID</span></span><br><span class="line"><span class="keyword">local</span> kickAnimation = Instance.new(<span class="string">&quot;Animation&quot;</span>)</span><br><span class="line">kickAnimation.AnimationId = <span class="string">&quot;rbxassetid://2515090838&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Load the animation onto the animator</span></span><br><span class="line"><span class="keyword">local</span> kickAnimationTrack = animator:LoadAnimation(kickAnimation)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Play the animation track</span></span><br><span class="line">kickAnimationTrack:Play()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- If a named event was defined for the animation, connect it to &quot;GetMarkerReachedSignal()&quot;</span></span><br><span class="line">kickAnimationTrack:GetMarkerReachedSignal(<span class="string">&quot;KickEnd&quot;</span>):Connect(<span class="function"><span class="keyword">function</span><span class="params">(paramString)</span></span></span><br><span class="line">    <span class="built_in">print</span>(paramString)</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/18/Roblox-UI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/18/Roblox-UI/" class="post-title-link" itemprop="url">Roblox-UI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-12-18 14:25:58 / 修改时间：14:28:14" itemprop="dateCreated datePublished" datetime="2022-12-18T14:25:58+08:00">2022-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Roblox/" itemprop="url" rel="index"><span itemprop="name">Roblox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="UI"><a href="#UI" class="headerlink" title="UI"></a><a target="_blank" rel="noopener" href="https://create.roblox.com/docs/tutorials/building/ui/creating-a-score-bar">UI</a></h1><h2 id="静态UI"><a href="#静态UI" class="headerlink" title="静态UI"></a>静态UI</h2><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><h4 id="StartGUI"><a href="#StartGUI" class="headerlink" title="StartGUI"></a>StartGUI</h4><p>这个东西存在于默认的项目管理器中，可以把它当成一个文件夹，用于存储所有 的UI界面</p>
<h4 id="ScreenGui"><a href="#ScreenGui" class="headerlink" title="ScreenGui"></a>ScreenGui</h4><p>这东西相当于UE中的控件蓝图，是一个个独立的UI，在<code>ScreenGui</code>里面可以添加各种各样的组件，比如<code>Frame</code>，<code>ImageButton</code>之类的</p>
<h4 id="Frame"><a href="#Frame" class="headerlink" title="Frame"></a>Frame</h4><p><code>ScreenGui</code>中的组件，相当于一个框架，里面可以塞进一些各种各样的小组件，原则上是将相同作用的组件放到同一个<code>Frame</code>里，方便进行总体控制嘛，总体控制是啥，我猜测是可视性这方面的</p>
<h4 id="UIListLayout"><a href="#UIListLayout" class="headerlink" title="UIListLayout"></a>UIListLayout</h4><p>横向排列的列表，虚幻里面也有，字面意思，放在里面的组件全部会按顺序横向排列，相应的，还有纵向排列的列表</p>
<p>值得注意的是，放在<code>UIListLayout</code>组件中的组件会存在一个属性<code>LayoutOrder</code>，通过修改这个属性，可以让<code>UIListLayout</code>中的组件按顺序排列</p>
<p><code>LayoutOrder</code>从1开始（不从0）</p>
<h4 id="UISizeConstraint"><a href="#UISizeConstraint" class="headerlink" title="UISizeConstraint"></a>UISizeConstraint</h4><p>这个东西存在的意义是：游戏适配PC，移动，各种屏幕的大小的时候会进行比例缩放，有时候在PC端UI很OK，但是在移动端就不对劲了。</p>
<p><code>UISizeConstraint</code>的<code>MaxSize</code>以及<code>MinSize</code>就是限制其最大Size和最小Size的</p>
<p>这玩意咋用？</p>
<p>点加号，给要限制大小的UI添加一个就行了（注意子类父类关系）</p>
<h4 id="AnchorPoint"><a href="#AnchorPoint" class="headerlink" title="AnchorPoint"></a>AnchorPoint</h4><p>锚点，我目前理解为和虚幻中的一样，就是在屏幕缩小或者放大的时候往锚点的位置靠拢（如有误，请后来者指正）</p>
<h4 id="制作一个静态UI"><a href="#制作一个静态UI" class="headerlink" title="制作一个静态UI"></a>制作一个静态UI</h4><p>这感觉没啥好说的，就是摆组件的事情，就不做赘述</p>
<h2 id="交互式UI"><a href="#交互式UI" class="headerlink" title="交互式UI"></a>交互式UI</h2><p>实现一个可点击的按钮，点击之后<code>Print</code>一串字符串</p>
<h2 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h2><h3 id="绑定UI点击事件到脚本"><a href="#绑定UI点击事件到脚本" class="headerlink" title="绑定UI点击事件到脚本"></a>绑定UI点击事件到脚本</h3><p>创建好一个Button之后，在Button下面创建一个<code>LocalScript</code>，记住！一定要是<code>LocalScript</code>，后面我会找一下几种<code>Script</code>的区别</p>
<h2 id="大致步骤"><a href="#大致步骤" class="headerlink" title="大致步骤"></a>大致步骤</h2><ol>
<li><p>在<code>StarterGui</code>下创建一个新的<code>ScreenGui</code>，命名为<code>MapScreenGui</code></p>
</li>
<li><p>在<code>MapScreenGui</code>下创建一个<code>Button</code>（随便啥Button）</p>
</li>
<li><p>给<code>Button</code>放在合适的位置，添加<code>UISizeConstraint</code></p>
</li>
<li><p>给<code>Button</code>添加一个<code>LocalScript</code>，编辑脚本，脚本内容如下</p>
</li>
</ol>
<h2 id="脚本内容"><a href="#脚本内容" class="headerlink" title="脚本内容"></a>脚本内容</h2><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Button是这个脚本的父类</span></span><br><span class="line"><span class="keyword">local</span> Button=script.Parent</span><br><span class="line"></span><br><span class="line"><span class="comment">--代理函数逻辑</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">OnButtonActivated</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Button activated!&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--Button.Activated:Connect(函数名)绑定代理</span></span><br><span class="line">Button.Activated:Connect(OnButtonActivated)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/18/Roblox-Tick/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/18/Roblox-Tick/" class="post-title-link" itemprop="url">Roblox-Tick</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-12-18 14:24:43 / 修改时间：14:25:26" itemprop="dateCreated datePublished" datetime="2022-12-18T14:24:43+08:00">2022-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Roblox/" itemprop="url" rel="index"><span itemprop="name">Roblox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Tick-与RunService-Heartbeat"><a href="#Tick-与RunService-Heartbeat" class="headerlink" title="Tick()与RunService:Heartbeat"></a>Tick()与RunService:Heartbeat</h1><h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>tick() 函数主要用于获取当前的游戏时间，或者在游戏中计算时间间隔或限制操作的执行频率。</p>
<p>这和虚幻中的Tick差距有些大，所以需要注意</p>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><h3 id="输出当前的游戏时间："><a href="#输出当前的游戏时间：" class="headerlink" title="输出当前的游戏时间："></a>输出当前的游戏时间：</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(tick())</span><br></pre></td></tr></table></figure>

<h3 id="计算游戏中的时间间隔"><a href="#计算游戏中的时间间隔" class="headerlink" title="计算游戏中的时间间隔"></a>计算游戏中的时间间隔</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> startTime = tick()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Do something here</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> elapsedTime = tick() - startTime</span><br></pre></td></tr></table></figure>

<h3 id="限制某个操作的执行频率"><a href="#限制某个操作的执行频率" class="headerlink" title="限制某个操作的执行频率"></a>限制某个操作的执行频率</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> lastPrintTime = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> tick() - lastPrintTime &gt;= <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">        lastPrintTime = tick()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h1 id="RunService-Heartbeat-事件"><a href="#RunService-Heartbeat-事件" class="headerlink" title="RunService:Heartbeat 事件"></a>RunService:Heartbeat 事件</h1><p>在 Roblox 中每帧执行某个操作，则可以使用 RunService:Heartbeat 事件</p>
<p>这就是和虚幻中的Tick相同作用的东西</p>
<p>Heartbeat 事件在每帧都会触发，并传递当前的游戏时间作为参数</p>
<h2 id="每帧执行打印操作"><a href="#每帧执行打印操作" class="headerlink" title="每帧执行打印操作"></a>每帧执行打印操作</h2><p>例如，以下代码可以在每帧执行打印操作：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> runService = game:GetService(<span class="string">&quot;RunService&quot;</span>)</span><br><span class="line"></span><br><span class="line">runService.Heartbeat:Connect(<span class="function"><span class="keyword">function</span><span class="params">(time)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">time</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，我们首先获取了游戏的 RunService 服务，并使用 Heartbeat 事件的 Connect 方法来连接到 Heartbeat 事件。当 Heartbeat 事件触发时，我们的回调函数就会执行，并打印当前的游戏时间。</p>
<p>此外，还可以使用 Heartbeat 事件来计算帧率或游戏中的每帧操作时间间隔。</p>
<h2 id="计算游戏的帧率"><a href="#计算游戏的帧率" class="headerlink" title="计算游戏的帧率"></a>计算游戏的帧率</h2><p>下面是一个计算帧率的简单示例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> runService = game:GetService(<span class="string">&quot;RunService&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> lastFrameTime = <span class="number">0</span></span><br><span class="line"><span class="keyword">local</span> totalFrames = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">runService.Heartbeat:Connect(<span class="function"><span class="keyword">function</span><span class="params">(time)</span></span></span><br><span class="line">    totalFrames = totalFrames + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">time</span> - lastFrameTime &gt;= <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">        lastFrameTime = <span class="built_in">time</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">local</span> fps = totalFrames</span><br><span class="line">        totalFrames = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(fps)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，我们首先获取了游戏的 RunService 服务，并使用 Heartbeat 事件的 Connect 方法来连接到 Heartbeat 事件。当 Heartbeat 事件触发时，我们的回调函数就会执行。</p>
<p>每次执行回调函数时，我们都会将总帧数增加 1。如果当前的游戏时间与上一次打印帧率的时间差超过了 1 秒，则我们就会打印当前的帧率。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/18/Roblox-Ray/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/18/Roblox-Ray/" class="post-title-link" itemprop="url">Roblox-Ray</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-12-18 14:22:45 / 修改时间：14:23:32" itemprop="dateCreated datePublished" datetime="2022-12-18T14:22:45+08:00">2022-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Roblox/" itemprop="url" rel="index"><span itemprop="name">Roblox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Ray"><a href="#Ray" class="headerlink" title="Ray"></a>Ray</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>Roblox 引擎中的 Ray 对象表示一条射线。它由两个分量（起点和方向）组成，分别表示射线的起点和方向。</p>
<p>射线是一条无限长的线段，它由一个起点和一个方向向量组成。射线可以用于表示光线或碰撞检测等场景中的线段。</p>
<p>Ray 对象可以通过 Ray.new() 函数创建。它接受两个参数：射线的起点和方向。起点是一个 Vector3 对象，表示三维坐标系中的点。方向是一个 Vector3 对象，表示射线的方向。</p>
<p>例如，以下代码创建了一条射线，它的起点为 (0, 0, 0) ，方向为 (1, 0, 0) 。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ray = Ray.new(Vector3.new(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), Vector3.new(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<h2 id="用Ray实现射线检测"><a href="#用Ray实现射线检测" class="headerlink" title="用Ray实现射线检测"></a>用Ray实现射线检测</h2><p>在 Roblox 引擎中，可以使用 Workspace:FindPartOnRayWithIgnoreList() 方法来实现射线检测。该方法接受一条 Ray 对象作为参数，并返回射线扫描到的第一个 Part 对象。如果射线没有碰到任何物体，则该方法会返回 nil 。</p>
<h3 id="Workspace-FindPartOnRayWithIgnoreList"><a href="#Workspace-FindPartOnRayWithIgnoreList" class="headerlink" title="Workspace:FindPartOnRayWithIgnoreList()"></a>Workspace:FindPartOnRayWithIgnoreList()</h3><p>Workspace:FindPartOnRayWithIgnoreList() 是 Roblox 引擎中的一个方法，用于在工作空间中查找第一个与射线相交的 Part 对象。该方法接受以下参数：</p>
<ul>
<li>Ray 对象：表示射线的路径。</li>
<li>忽略列表：表示忽略的实例列表。射线扫描时会自动忽略这些实例。</li>
<li>是否可碰撞：表示射线是否与可碰撞物体相交。如果为 true，则射线只能与可碰撞物体相交。如果为 false，则射线不能与可碰撞物体相交。</li>
<li>是否不可碰撞：表示射线是否与不可碰撞物体相交。如果为 true，则射线只能与不可碰撞物体相交。如果为 false，则射线不能与不可碰撞物体相交。</li>
</ul>
<p>该方法返回值是射线扫描到的第一个与射线相交的 Part 对象。如果射线没有碰到任何物体，则该方法会返回 nil。</p>
<p>例如，以下代码实现了射击效果，如果射线碰到了一个物体，则会创建一个激光束特效：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ray = Ray.new(</span><br><span class="line">    maid.humanoidRootPart.Position,</span><br><span class="line">    maid.humanoidRootPart.CFrame.lookVector</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> part = Workspace:FindPartOnRayWithIgnoreList(ray, &#123;</span><br><span class="line">    maid.instance,</span><br><span class="line">&#125;, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> part <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">local</span> laser = Instance.new(<span class="string">&quot;Part&quot;</span>)</span><br><span class="line">    laser.Name = <span class="string">&quot;Laser&quot;</span></span><br><span class="line">    laser.BrickColor = BrickColor.new(<span class="string">&quot;Bright red&quot;</span>)</span><br><span class="line">    laser.Anchored = <span class="literal">true</span></span><br><span class="line">    laser.CanCollide = <span class="literal">false</span></span><br><span class="line">    laser.Size = Vector3.new(<span class="number">0.2</span>, <span class="number">0.2</span>, (part.Position - maid.humanoidRootPart.Position).Magnitude)</span><br><span class="line">    laser.CFrame = CFrame.new(</span><br><span class="line">        maid.humanoidRootPart.Position,</span><br><span class="line">        part.Position</span><br><span class="line">    )</span><br><span class="line">    laser.Parent = Workspace</span><br><span class="line"></span><br><span class="line">    wait(<span class="number">0.2</span>)</span><br><span class="line">    laser:Destroy()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>例如，以下代码使用射线检测来判断两个实例之间是否存在障碍物：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ray = Ray.new(</span><br><span class="line">    maid.humanoidRootPart.Position,</span><br><span class="line">    (targetInstance.Parent.HumanoidRootPart.Position - maid.humanoidRootPart.Position).Unit * distance</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> part = Workspace:FindPartOnRayWithIgnoreList(ray, &#123;</span><br><span class="line">    targetInstance.Parent, maid.instance,</span><br><span class="line">&#125;, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> part <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 如果 part 为 nil，说明没有障碍物</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="用Ray实现视线跟踪"><a href="#用Ray实现视线跟踪" class="headerlink" title="用Ray实现视线跟踪"></a>用Ray实现视线跟踪</h2><p>视线跟踪是指使用射线来检测视线所看到的物体。</p>
<p>在 Roblox 引擎中，可以使用 <code>Workspace:FindPartOnRayWithIgnoreList()</code> 方法来实现视线跟踪。该方法接受一条 Ray 对象作为参数，并返回射线扫描到的第一个 Part 对象。如果射线没有碰到任何物体，则该方法会返回 nil 。</p>
<p>例如，以下代码使用视线跟踪来检测玩家所看到的物体：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ray = Ray.new(</span><br><span class="line">    maid.humanoidRootPart.Position,</span><br><span class="line">    maid.humanoidRootPart.CFrame.lookVector</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> part = Workspace:FindPartOnRayWithIgnoreList(ray, &#123;</span><br><span class="line">    maid.instance,</span><br><span class="line">&#125;, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> part <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- 如果 part 不为 nil，说明视线扫描到了一个物体</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="用Ray实现范围伤害"><a href="#用Ray实现范围伤害" class="headerlink" title="用Ray实现范围伤害"></a>用Ray实现范围伤害</h2><p>在 Roblox 引擎中，可以使用 Ray 对象和 Workspace:FindPartOnRayWithIgnoreList() 方法来实现范围伤害。</p>
<p>首先，需要定义一个范围值，表示伤害范围的半径。例如，定义一个叫做 ATTACK_RADIUS 的变量，表示伤害范围为 10 个单位。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ATTACK_RADIUS = <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>然后，需要遍历范围内的每个实例，并判断它们是否在伤害范围之内。可以使用 CollectionService:GetTagged() 方法来获取所有被指定标签所标记的实例。然后遍历这些实例，并判断它们是否在伤害范围之内。</p>
<p>例如，以下代码使用范围伤害来攻击所有被标记为 “Enemy” 的实例：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> enemies = CollectionService:GetTagged(<span class="string">&quot;Enemy&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, enemy <span class="keyword">in</span> <span class="built_in">ipairs</span>(enemies) <span class="keyword">do</span></span><br><span class="line">    <span class="comment">-- 计算实例与攻击者之间的距离</span></span><br><span class="line">    <span class="keyword">local</span> distance = (maid.humanoidRootPart.Position - enemy.Position).Magnitude</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 判断是否在伤害范围之内</span></span><br><span class="line">    <span class="keyword">if</span> distance &lt;= ATTACK_RADIUS <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- 创建一条射线</span></span><br><span class="line">        <span class="keyword">local</span> ray = Ray.new(</span><br><span class="line">            maid.humanoidRootPart.Position,</span><br><span class="line">            (enemy.Position - maid.humanoidRootPart.Position).Unit * distance</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 检测是否有障碍物</span></span><br><span class="line">        <span class="keyword">local</span> part = Workspace:FindPartOnRayWithIgnoreList(ray, &#123;</span><br><span class="line">            maid.instance,</span><br><span class="line">        &#125;, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 如果没有障碍物，则对实例造成伤害</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> part <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- 计算伤害值</span></span><br><span class="line">            <span class="keyword">local</span> damage = <span class="built_in">math</span>.<span class="built_in">max</span>(<span class="number">0</span>, <span class="number">100</span> - distance)</span><br><span class="line"></span><br><span class="line">            <span class="comment">-- 造成伤害</span></span><br><span class="line">            enemy.Health = enemy.Health - damage</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="Ray实现射击效果"><a href="#Ray实现射击效果" class="headerlink" title="Ray实现射击效果"></a>Ray实现射击效果</h2><p>首先，需要定义一个射线，表示子弹的路径。可以使用 Ray.new() 方法来创建一条射线。例如，以下代码定义了一条射线，表示子弹从枪口发射出去：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ray = Ray.new(</span><br><span class="line">    maid.humanoidRootPart.Position,</span><br><span class="line">    maid.humanoidRootPart.CFrame.lookVector</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>然后，需要使用 Workspace:FindPartOnRayWithIgnoreList() 方法来执行射击。该方法接受一条 Ray 对象作为参数，并返回射线扫描到的第一个 Part 对象。如果射线没有碰到任何物体，则该方法会返回 nil 。</p>
<p>例如，以下代码实现了射击效果，如果射线碰到了一个物体，则会创建一个激光束特效：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ray = Ray.new(</span><br><span class="line">    maid.humanoidRootPart.Position,</span><br><span class="line">    maid.humanoidRootPart.CFrame.lookVector</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> part = Workspace:FindPartOnRayWithIgnoreList(ray, &#123;</span><br><span class="line">    maid.instance,</span><br><span class="line">&#125;, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> part <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">local</span> laser = Instance.new(<span class="string">&quot;Part&quot;</span>)</span><br><span class="line">    laser.Name = <span class="string">&quot;Laser&quot;</span></span><br><span class="line">    laser.BrickColor = BrickColor.new(<span class="string">&quot;Bright red&quot;</span>)</span><br><span class="line">    laser.Anchored = <span class="literal">true</span></span><br><span class="line">    laser.CanCollide = <span class="literal">false</span></span><br><span class="line">    laser.Size = Vector3.new(<span class="number">0.2</span>, <span class="number">0.2</span>, (part.Position - maid.humanoidRootPart.Position).Magnitude)</span><br><span class="line">    laser.CFrame = CFrame.new(</span><br><span class="line">        maid.humanoidRootPart.Position,</span><br><span class="line">        part.Position</span><br><span class="line">    )</span><br><span class="line">    laser.Parent = Workspace</span><br><span class="line"></span><br><span class="line">    wait(<span class="number">0.2</span>)</span><br><span class="line">    laser:Destroy()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/12/18/Roblox-HingedDoor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="williny">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Williny'home">
      <meta itemprop="description" content="孤独是人生的常态">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Williny'home">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/18/Roblox-HingedDoor/" class="post-title-link" itemprop="url">Roblox-HingedDoor</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-12-18 14:21:17 / 修改时间：14:22:13" itemprop="dateCreated datePublished" datetime="2022-12-18T14:21:17+08:00">2022-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Roblox/" itemprop="url" rel="index"><span itemprop="name">Roblox</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="通过铰链实现旋转门"><a href="#通过铰链实现旋转门" class="headerlink" title="通过铰链实现旋转门"></a>通过铰链实现旋转门</h1><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="Anchored"><a href="#Anchored" class="headerlink" title="Anchored"></a>Anchored</h3><p>这是一些<code>部件</code>的默认属性，此值为true，则此<code>部件</code>就不会移动</p>
<p>就理解为无敌重，重到玩家推不动</p>
<h4 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h4><p>选择某个部件-&gt;属性管理器-&gt;<code>Data</code>-&gt;<code>Aechivable</code></p>
<h3 id="Attachment"><a href="#Attachment" class="headerlink" title="Attachment"></a>Attachment</h3><p>部件的组件，可以让这个部件围绕着这个组件进行旋转</p>
<p>注意：想要看到这个<code>Attachment</code>，就必须打开该部件的<code>约束详情</code></p>
<h4 id="约束详情位置"><a href="#约束详情位置" class="headerlink" title="约束详情位置"></a>约束详情位置</h4><p>模型-&gt;约束-&gt;约束详情</p>
<h4 id="Attachment的旋转轴"><a href="#Attachment的旋转轴" class="headerlink" title="Attachment的旋转轴"></a>Attachment的旋转轴</h4><p>打开<code>约束详情</code>之后，凑近看<code>Attachment</code>，则可以看到为一个球形，带俩轴，一个<code>黄色</code>，一个<code>橙色</code></p>
<p>我们会一直围绕黄色的轴旋转</p>
<p>橙色的轴，应该是配合后面的<code>HingeConstraint</code>来限制旋转角度的方向</p>
<ul>
<li>也就是说，不会出现在墙里旋转的情况</li>
</ul>
<h3 id="HingeConstraint"><a href="#HingeConstraint" class="headerlink" title="HingeConstraint"></a>HingeConstraint</h3><p>部件的组件，将两个<code>Attachment</code>添加到<code>Attachments</code>属性栏中进行组合，实现约束旋转角度的效果</p>
<h2 id="大致步骤"><a href="#大致步骤" class="headerlink" title="大致步骤"></a>大致步骤</h2><ol>
<li><p>创建两个部件，分别作为<code>Door</code>和<code>DoorFrame</code></p>
</li>
<li><p>给<code>DoorFrame</code>的属性<code>Aechivable</code>设置为<code>true</code></p>
</li>
<li><p>分别给<code>Door</code>和<code>DoorFrame</code>添加组件<code>Attachment</code>，分别命名为<code>DoorFrameAttachment</code>，<code>DoorAttachment</code></p>
</li>
<li><p>调整<code>DoorFrameAttachment</code>，<code>DoorAttachment</code>的黄色的轴向上，橙色的轴同时指向门框方向</p>
</li>
<li><p>给<code>DoorFrame</code>部件添加组件<code>HingeConstraint</code>，在其<code>Attachments</code>属性中分别添加<code>DoorFrameAttachment</code>，<code>DoorAttachment</code></p>
</li>
<li><p>调整<code>HingeConstraint</code>中的<code>Limits</code>栏中的<code>LowerAngle</code>和<code>UpperAngle</code>分别为-90和90</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">williny</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
